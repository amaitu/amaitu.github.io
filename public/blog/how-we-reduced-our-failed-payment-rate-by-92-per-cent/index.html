<!DOCTYPE html>
<html lang="en">
<head>

    <title>How we reduced our failed payment rate by 92%</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="./../assets/built/screen.css?v=8866a438d0" />

    <link rel="icon" href="./../favicon.png" type="image/png" />
    <link rel="canonical" href="https://sgbarker.com/blog/how-we-reduced-our-failed-payment-rate-by-92-per-cent/" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <link rel="amphtml" href="https://sgbarker.com/blog/how-we-reduced-our-failed-payment-rate-by-92-per-cent/amp/" />
    
    <meta property="og:site_name" content="Steve Barker" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="How we reduced our failed payment rate by 92%" />
    <meta property="og:description" content="Originally posted on Gousto Engineering &amp;amp; Data Most Gousto customers choose to get their recipe boxes on a subscription basis: every week they choose their recipes from our menu, and we pick, pack and deliver them to their door. To give customers as much flexibility as possible, we let customers" />
    <meta property="og:url" content="https://sgbarker.com/blog/how-we-reduced-our-failed-payment-rate-by-92-per-cent/" />
    <meta property="og:image" content="https://sgbarker.com/blog/content/images/2021/03/pre-auth-flow-1.png" />
    <meta property="article:published_time" content="2020-11-16T18:15:00.000Z" />
    <meta property="article:modified_time" content="2021-03-20T18:17:29.000Z" />
    <meta property="article:tag" content="Software Engineering" />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="How we reduced our failed payment rate by 92%" />
    <meta name="twitter:description" content="Originally posted on Gousto Engineering &amp;amp; Data Most Gousto customers choose to get their recipe boxes on a subscription basis: every week they choose their recipes from our menu, and we pick, pack and deliver them to their door. To give customers as much flexibility as possible, we let customers" />
    <meta name="twitter:url" content="https://sgbarker.com/blog/how-we-reduced-our-failed-payment-rate-by-92-per-cent/" />
    <meta name="twitter:image" content="https://sgbarker.com/blog/content/images/2021/03/pre-auth-flow-1.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Steve Barker" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Software Engineering" />
    <meta property="og:image:width" content="1696" />
    <meta property="og:image:height" content="648" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Steve Barker",
        "url": "https://sgbarker.com/blog/",
        "logo": {
            "@type": "ImageObject",
            "url": "https://sgbarker.com/blog/favicon.png"
        }
    },
    "author": {
        "@type": "Person",
        "name": "Steve Barker",
        "image": {
            "@type": "ImageObject",
            "url": "https://sgbarker.com/blog/content/images/2021/08/ben-sweet-2LowviVHZ-E-unsplash.jpg",
            "width": 2000,
            "height": 1125
        },
        "url": "https://sgbarker.com/blog/author/steve/",
        "sameAs": [
            "https://sgbarker.com"
        ]
    },
    "headline": "How we reduced our failed payment rate by 92%",
    "url": "https://sgbarker.com/blog/how-we-reduced-our-failed-payment-rate-by-92-per-cent/",
    "datePublished": "2020-11-16T18:15:00.000Z",
    "dateModified": "2021-03-20T18:17:29.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "https://sgbarker.com/blog/content/images/2021/03/pre-auth-flow-1.png",
        "width": 1696,
        "height": 648
    },
    "keywords": "Software Engineering",
    "description": "Originally posted on Gousto Engineering &amp; Data\n[https://medium.com/gousto-engineering-techbrunch]\n\nMost Gousto customers choose to get their recipe boxes\n[https://www.gousto.co.uk/] on a subscription basis: every week they choose\ntheir recipes from our menu, and we pick, pack and deliver them to their door.\nTo give customers as much flexibility as possible, we let customers edit their\nbox right up until it’s sent to one of our factories for picking.\n\nThis process works really well most of the ti",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://sgbarker.com/blog/"
    }
}
    </script>
<style>:root {--ghost-accent-color: #000000;}</style>
    <meta name="generator" content="Ghost 4.12" />
    <link rel="alternate" type="application/rss+xml" title="Steve Barker" href="https://sgbarker.com/blog/rss/" />

</head>
<body class="post-template tag-software-engineering">
<div class="viewport">

    <header id="gh-head" class="gh-head ">
        <nav class="gh-head-inner inner gh-container">

            <div class="gh-head-brand">
                <a class="gh-head-logo" href="https://sgbarker.com/blog">
                        Steve Barker
                </a>
                <a class="gh-burger" role="button">
                    <div class="gh-burger-box">
                        <div class="gh-burger-inner"></div>
                    </div>
                </a>
            </div>
            <div class="gh-head-menu">
                <ul class="nav">
    <li class="nav-home"><a href="https://sgbarker.com">Home</a></li>
    <li class="nav-latest-posts"><a href="https://sgbarker.com/blog/">Latest Posts</a></li>
</ul>

            </div>
            <div class="gh-head-actions">
                <div class="gh-social">
                </div>

                    <a class="gh-head-button" href="#/portal/signup">Subscribe</a>
            </div>
        </nav>
    </header>

    <main>
        



<article class="article post tag-software-engineering">

    <header class="article-header gh-canvas">

        <section class="article-tag">
            <a href="https://sgbarker.com/blog/tag/software-engineering/">Software Engineering</a>
        </section>

        <h1 class="article-title">How we reduced our failed payment rate by 92%</h1>


        <div class="article-byline">
            <section class="article-byline-content">
                <ul class="author-list">
                    <li class="author-list-item">
                        <a href="./../author/steve/" class="author-avatar">
                            <img class="author-profile-image" src="./../content/images/size/w100/2021/08/ben-sweet-2LowviVHZ-E-unsplash.jpg" alt="Steve Barker" />
                        </a>
                    </li>
                </ul>
                <div class="article-byline-meta">
                    <h4 class="author-name"><a href="./../author/steve/">Steve Barker</a></h4>
                    <div class="byline-meta-content">
                        <time class="byline-meta-date" datetime="2020-11-16">Nov 16, 2020</time>
                        <span class="byline-reading-time"><span class="bull">&bull;</span> 4 min read</span>
                    </div>
                </div>
            </section>
        </div>

        <figure class="article-image">
            <img
                srcset="./../content/images/size/w300/2021/03/pre-auth-flow-1.png 300w,
                        ./../content/images/size/w600/2021/03/pre-auth-flow-1.png 600w,
                        ./../content/images/size/w1000/2021/03/pre-auth-flow-1.png 1000w,
                        ./../content/images/size/w2000/2021/03/pre-auth-flow-1.png 2000w"
                sizes="(min-width: 1400px) 1400px, 92vw"
                src="./../content/images/size/w2000/2021/03/pre-auth-flow-1.png"
                alt="How we reduced our failed payment rate by 92%"
            />
        </figure>
    </header>

    <section class="gh-content gh-canvas">
        <p><em>Originally posted on <a href="https://medium.com/gousto-engineering-techbrunch">Gousto Engineering &amp; Data</a></em></p><p>Most Gousto customers choose to get their <a href="https://www.gousto.co.uk/" rel="noopener">recipe boxes</a> on a subscription basis: every week they choose their recipes from our menu, and we pick, pack and deliver them to their door. To give customers as much flexibility as possible, we let customers edit their box right up until it’s sent to one of our factories for picking.</p><figure class="kg-card kg-image-card kg-width-wide"><img src="./..//content/images/2021/03/box-flow.png" class="kg-image" alt loading="lazy" width="1268" height="526" srcset="https://sgbarker.com/blog/content/images/size/w600/2021/03/box-flow.png 600w, https://sgbarker.com/blog/content/images/size/w1000/2021/03/box-flow.png 1000w, https://sgbarker.com/blog/content/images/2021/03/box-flow.png 1268w" sizes="(min-width: 1200px) 1200px"></figure><h4 id="this-process-works-really-well-most-of-the-time-but-what-happens-when-a-customer%E2%80%99s-payment-fails">This process works really well most of the time. But what happens when a customer’s payment fails?</h4><p>It’s natural that a proportion of payments will fail — customers’ cards have changed, or there aren’t enough funds in the account. At Gousto we had a natural failed payment rate of around 2% for existing customers.</p><p>Until recently we only had two ways of handling a failed payment. First, we could send out the box anyway and put a debit on the customer’s account. Alternatively, we could just cancel the customer’s order.</p><p>Neither of these is a good solution. We never want to have to cancel a customer’s box, nor do we want to put a customer into ‘debt’. The majority of failed payments are because a customer has forgotten to update their card details and are still expecting to receive their order. I’m sure you can imagine how frustrating it might be to lose your food delivery for the week just because your debit card expired.</p><h4 id="how-did-we-reduce-failed-payments">How did we reduce failed payments?</h4><p>We decided to request a ‘dry run’ payment 24 hours before the actual payment is due — this is known as a <em>pre-authorisation. </em>Pre-auths allow merchants like Gousto to ‘reserve’ some amount of money against a customer’s payment method, without actually charging them. When we attempt to reserve these funds, we’ll receive a success or failure response from the customer’s bank. If unsuccessful, we can ask the customer to update their payment details.</p><figure class="kg-card kg-image-card kg-width-wide"><img src="./..//content/images/2021/03/pre-auth-flow.png" class="kg-image" alt loading="lazy" width="1696" height="648" srcset="https://sgbarker.com/blog/content/images/size/w600/2021/03/pre-auth-flow.png 600w, https://sgbarker.com/blog/content/images/size/w1000/2021/03/pre-auth-flow.png 1000w, https://sgbarker.com/blog/content/images/size/w1600/2021/03/pre-auth-flow.png 1600w, https://sgbarker.com/blog/content/images/2021/03/pre-auth-flow.png 1696w" sizes="(min-width: 1200px) 1200px"></figure><p>As you can see, pre-auths allow us to catch a failed payment. We then email customers and give them 24 hours to update their card details in time for the final payment. This alone reduced our failed payment rate by 92%!</p><p>Many customers will receive a notification from their bank when the pre-auth is requested, which serves as an extra reminder of their upcoming box, with time for them to update their recipes before it’s dispatched. If the customer no longer wishes to receive their order, they also have the opportunity to cancel it through the app before it’s already paid for and dispatched. This reduces wasteful unintentional orders.</p><h4 id="how-do-pre-auths-actually-work">How do pre-auths actually work?</h4><p>When a merchant <a href="https://www.paymill.com/en/glossary/card-pre-authorisation/" rel="noopener">pre-authorises</a> funds on an account, it doesn’t have access to those funds yet; they’re ring-fenced for that merchant to use at some future point in time and the customer can’t use those funds for anything else.</p><p>If the merchant doesn’t end up charging the customer, the funds are released back to the customer by their bank after a period of time, typically five days. We built our system so that if a customer cancels a box that has been pre-authorised but not yet paid for, we would immediately void the pre-authorisation. This ensures we aren’t holding onto customers’ funds for any longer than is necessary.</p><hr><h4 id="how-did-we-engineer-this-enter-data-bulkheading"><strong>How did we engineer this? <em>Enter: Data bulkheading.</em></strong></h4><p>As I mentioned above, once a Gousto order is ‘cut-off’, it is no longer editable by the customer and is sent to one of our factories to be packed. This happens in batches of orders at a time, so it’s extremely important that this process is fault tolerant and speedy. To this end, many Gousto applications use a <a href="https://stackoverflow.com/questions/30391809/what-is-bulkhead-pattern-used-by-hystrix" rel="noopener"><em>bulkhead</em> architecture</a>, and our shiny new pre-auth system is no exception.</p><p>The pre-auth process comprises a series of <a href="https://medium.com/gousto-engineering-techbrunch/powering-the-supply-chain-with-serverless-architecture-part-2-323932bf4424">serverless</a> functions, but we don’t want these functions to have to rely on a centralised data store to do their job. Instead, they have their own data store, which keeps a copy of all upcoming orders with payments due in the near future. Not only does this save additional functions from putting more load on a single database, but should there be a fault in another part of the system, the payments data store will be unaffected. Fun fact: the bulkhead pattern is named after the isolated sections of a ship’s hull. If the hull is pierced, only the damaged section fills with water, preventing the rest from flooding.</p><figure class="kg-card kg-image-card"><img src="./..//content/images/2021/03/container-ship.png" class="kg-image" alt loading="lazy" width="1172" height="806" srcset="https://sgbarker.com/blog/content/images/size/w600/2021/03/container-ship.png 600w, https://sgbarker.com/blog/content/images/size/w1000/2021/03/container-ship.png 1000w, https://sgbarker.com/blog/content/images/2021/03/container-ship.png 1172w" sizes="(min-width: 720px) 720px"></figure><p>The pre-auth system is an ideal use case for serverless functions. Demand for these services is very spiky — when a batch of orders is ‘cut off’ for example, we need a large amount of concurrency to quickly process them all. The rest of the time, we don’t see much activity, so it doesn’t make sense to pay for running servers.</p><p>For our payment functions to maintain a storage bulkhead, they need to be kept up to date with the state of orders. We utilise AWS SNS and SQS for this or — in other words — pub’ sub’. When any application within Gousto makes a change to an order, we publish to a topic. One of our payment functions is subscribed to this topic, and if the change affects the price or payment of the order, this update is added to its queue. The change is then persisted to the payments data store, ready to be processed.</p><p>After testing pre-auths on a small group of customers for a few weeks, we saw very positive results, both financially and from the feedback we received from customers! We have now rolled this out to everyone who uses Gousto.</p>
    </section>


</article>

<section class="footer-cta">
    <div class="inner">
        <h2>Sign up for more like this.</h2>
        <a class="footer-cta-button" href="#/portal">
            <div>Enter your email</div>
            <span>Subscribe</span>
        </a>
    </div>
</section>


<aside class="read-more-wrap">
    <div class="read-more inner">


                    
<article class="post-card post ">

    <a class="post-card-image-link" href="./../my-ideal-fudge-recipe/">
        <img class="post-card-image"
            srcset="./../content/images/size/w300/2020/12/12---Baking-3-1.jpg 300w,
                    ./../content/images/size/w600/2020/12/12---Baking-3-1.jpg 600w,
                    ./../content/images/size/w1000/2020/12/12---Baking-3-1.jpg 1000w,
                    ./../content/images/size/w2000/2020/12/12---Baking-3-1.jpg 2000w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="./../content/images/size/w600/2020/12/12---Baking-3-1.jpg"
            alt="My Ideal Fudge Recipe"
            loading="lazy"
        />
    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="./../my-ideal-fudge-recipe/">
            <header class="post-card-header">
                <h2 class="post-card-title">My Ideal Fudge Recipe</h2>
            </header>
            <section class="post-card-excerpt">
                <p>The only difficult thing about making delicious fudge is how long and at what temperature to cook it for. IngredientsMakes: ~900g of fudge  550g demerara sugar 100g butter 170g golden syrup 1.5-2 tps sea salt flakes 30g maple syrup 350ml double cream 1 tsp vanilla extract Optional:  Sugar thermometer</p>
            </section>
        </a>

        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
                    <a href="./../author/steve/" class="static-avatar">
                        <img class="author-profile-image" src="./../content/images/size/w100/2021/08/ben-sweet-2LowviVHZ-E-unsplash.jpg" alt="Steve Barker" />
                    </a>
                </li>
            </ul>
            <div class="post-card-byline-content">
                <span><a href="./../author/steve/">Steve Barker</a></span>
                <span class="post-card-byline-date"><time datetime="2020-12-19">Dec 19, 2020</time> <span class="bull">&bull;</span> 3 min read</span>
            </div>
        </footer>

    </div>

</article>
                    
<article class="post-card post ">

    <a class="post-card-image-link" href="./../why-ghost/">
        <img class="post-card-image"
            srcset="./../content/images/size/w300/2021/01/ghost.png 300w,
                    ./../content/images/size/w600/2021/01/ghost.png 600w,
                    ./../content/images/size/w1000/2021/01/ghost.png 1000w,
                    ./../content/images/size/w2000/2021/01/ghost.png 2000w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="./../content/images/size/w600/2021/01/ghost.png"
            alt="Why Ghost?"
            loading="lazy"
        />
    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="./../why-ghost/">
            <header class="post-card-header">
                <h2 class="post-card-title">Why Ghost?</h2>
            </header>
            <section class="post-card-excerpt">
                <p>Back in the day I used WordPress quite a bit. It had many appealing qualities - it was easy to host, very extendable and had a huge community of users. So huge that even in 2020, WordPress runs over 33% of all websites. I used WordPress for all kinds of</p>
            </section>
        </a>

        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
                    <a href="./../author/steve/" class="static-avatar">
                        <img class="author-profile-image" src="./../content/images/size/w100/2021/08/ben-sweet-2LowviVHZ-E-unsplash.jpg" alt="Steve Barker" />
                    </a>
                </li>
            </ul>
            <div class="post-card-byline-content">
                <span><a href="./../author/steve/">Steve Barker</a></span>
                <span class="post-card-byline-date"><time datetime="2020-09-24">Sep 24, 2020</time> <span class="bull">&bull;</span> 1 min read</span>
            </div>
        </footer>

    </div>

</article>
                    
<article class="post-card post ">

    <a class="post-card-image-link" href="./../moscow-mule-twist/">
        <img class="post-card-image"
            srcset="./../content/images/size/w300/2020/07/alex-plesovskich-HNqdKhoBBfA-unsplash.jpg 300w,
                    ./../content/images/size/w600/2020/07/alex-plesovskich-HNqdKhoBBfA-unsplash.jpg 600w,
                    ./../content/images/size/w1000/2020/07/alex-plesovskich-HNqdKhoBBfA-unsplash.jpg 1000w,
                    ./../content/images/size/w2000/2020/07/alex-plesovskich-HNqdKhoBBfA-unsplash.jpg 2000w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="./../content/images/size/w600/2020/07/alex-plesovskich-HNqdKhoBBfA-unsplash.jpg"
            alt="Moscow Mule Twist"
            loading="lazy"
        />
    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="./../moscow-mule-twist/">
            <header class="post-card-header">
                <h2 class="post-card-title">Moscow Mule Twist</h2>
            </header>
            <section class="post-card-excerpt">
                <p>My take on the simple Moscow Mule cocktail. I use a quince infused vodka which gives a unique twist. I picked up the quince vodka from Szambelan, a vodka producer in Krakow - but you can infuse your own or buy some online too. If you're adding extra fresh ginger,</p>
            </section>
        </a>

        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
                    <a href="./../author/steve/" class="static-avatar">
                        <img class="author-profile-image" src="./../content/images/size/w100/2021/08/ben-sweet-2LowviVHZ-E-unsplash.jpg" alt="Steve Barker" />
                    </a>
                </li>
            </ul>
            <div class="post-card-byline-content">
                <span><a href="./../author/steve/">Steve Barker</a></span>
                <span class="post-card-byline-date"><time datetime="2020-07-04">Jul 4, 2020</time> <span class="bull">&bull;</span> 1 min read</span>
            </div>
        </footer>

    </div>

</article>

    </div>
</aside>


    </main>

    <footer class="site-footer outer">
        <div class="inner">
            <section class="copyright"><a href="https://sgbarker.com/blog">Steve Barker</a> &copy; 2021</section>
            <nav class="site-footer-nav">
                <ul class="nav">
    <li class="nav-photos"><a href="https://unsplash.com/@amaitu/">Photos</a></li>
    <li class="nav-other-writing"><a href="https://sgbarker.com/blog/other-writing/">Other Writing</a></li>
</ul>

            </nav>
            <div><a href="https://ghost.org/" target="_blank" rel="noopener">Powered by Ghost</a></div>
        </div>
    </footer>

</div>


<script
    src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous">
</script>
<script src="./../assets/built/casper.js?v=8866a438d0"></script>
<script>
$(document).ready(function () {
    // Mobile Menu Trigger
    $('.gh-burger').click(function () {
        $('body').toggleClass('gh-head-open');
    });
    // FitVids - Makes video embeds responsive
    $(".gh-content").fitVids();
});
</script>



</body>
</html>
