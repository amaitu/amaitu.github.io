<!DOCTYPE html>
<html lang="en">
<head>

    <title>How we reduced our failed payment rate by 92%</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="./../assets/built/screen.css?v=6e51bcce7f" />

    <link rel="icon" href="https://sgbarker.com/blog/content/images/size/w256h256/2021/04/apple-icon-180x180.png" type="image/png" />
    <link rel="canonical" href="https://sgbarker.com/blog/how-we-reduced-our-failed-payment-rate-by-92-per-cent/" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <link rel="amphtml" href="https://sgbarker.com/blog/how-we-reduced-our-failed-payment-rate-by-92-per-cent/amp/" />
    
    <meta property="og:site_name" content="Steve Barker" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="How we reduced our failed payment rate by 92%" />
    <meta property="og:description" content="Originally posted on Gousto Engineering &amp; Data
[https://medium.com/gousto-engineering-techbrunch]

Most Gousto customers choose to get their recipe boxes
[https://www.gousto.co.uk/] on a subscription basis: every week they choose
their recipes from our menu, and we pick, pack and deliver them to their door.
To give customers" />
    <meta property="og:url" content="https://sgbarker.com/blog/how-we-reduced-our-failed-payment-rate-by-92-per-cent/" />
    <meta property="og:image" content="https://sgbarker.com/blog/content/images/2021/03/pre-auth-flow-1.png" />
    <meta property="article:published_time" content="2020-11-16T18:15:00.000Z" />
    <meta property="article:modified_time" content="2021-03-20T18:17:29.000Z" />
    <meta property="article:tag" content="Software Engineering" />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="How we reduced our failed payment rate by 92%" />
    <meta name="twitter:description" content="Originally posted on Gousto Engineering &amp; Data
[https://medium.com/gousto-engineering-techbrunch]

Most Gousto customers choose to get their recipe boxes
[https://www.gousto.co.uk/] on a subscription basis: every week they choose
their recipes from our menu, and we pick, pack and deliver them to their door.
To give customers" />
    <meta name="twitter:url" content="https://sgbarker.com/blog/how-we-reduced-our-failed-payment-rate-by-92-per-cent/" />
    <meta name="twitter:image" content="https://sgbarker.com/blog/content/images/2021/03/pre-auth-flow-1.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Steve Barker" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Software Engineering" />
    <meta property="og:image:width" content="1696" />
    <meta property="og:image:height" content="648" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Steve Barker",
        "url": "https://sgbarker.com/blog/",
        "logo": {
            "@type": "ImageObject",
            "url": "https://sgbarker.com/blog/content/images/size/w256h256/2021/04/apple-icon-180x180.png",
            "width": 60,
            "height": 60
        }
    },
    "author": {
        "@type": "Person",
        "name": "Steve Barker",
        "image": {
            "@type": "ImageObject",
            "url": "https://sgbarker.com/blog/content/images/2021/09/ben-sweet-2LowviVHZ-E-unsplash.jpg",
            "width": 2000,
            "height": 1125
        },
        "url": "https://sgbarker.com/blog/author/steve/",
        "sameAs": []
    },
    "headline": "How we reduced our failed payment rate by 92%",
    "url": "https://sgbarker.com/blog/how-we-reduced-our-failed-payment-rate-by-92-per-cent/",
    "datePublished": "2020-11-16T18:15:00.000Z",
    "dateModified": "2021-03-20T18:17:29.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "https://sgbarker.com/blog/content/images/2021/03/pre-auth-flow-1.png",
        "width": 1696,
        "height": 648
    },
    "keywords": "Software Engineering",
    "description": "Originally posted on Gousto Engineering &amp; Data\n[https://medium.com/gousto-engineering-techbrunch]\n\nMost Gousto customers choose to get their recipe boxes\n[https://www.gousto.co.uk/] on a subscription basis: every week they choose\ntheir recipes from our menu, and we pick, pack and deliver them to their door.\nTo give customers as much flexibility as possible, we let customers edit their\nbox right up until it’s sent to one of our factories for picking.\n\nThis process works really well most of the ti",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://sgbarker.com/blog/"
    }
}
    </script>

    <meta name="generator" content="Ghost 5.2" />
    <link rel="alternate" type="application/rss+xml" title="Steve Barker" href="https://sgbarker.com/blog/rss/" />
    
    <script defer src="./../public/cards.min.js?v=6e51bcce7f"></script><style>:root {--ghost-accent-color: #000000;}</style>
    <link rel="stylesheet" type="text/css" href="./../public/cards.min.css?v=6e51bcce7f">

</head>
<body class="post-template tag-software-engineering has-cover">
<div class="viewport">

    <header id="gh-head" class="gh-head outer">
        <nav class="gh-head-inner inner">

            <div class="gh-head-brand">
                <a class="gh-head-logo no-image" href="https://sgbarker.com/blog">
                        Steve Barker
                </a>
                <a class="gh-burger" role="button">
                    <div class="gh-burger-box">
                        <div class="gh-burger-inner"></div>
                    </div>
                </a>
            </div>
            <div class="gh-head-menu">
                <ul class="nav">
    <li class="nav-home"><a href="https://sgbarker.com">Home</a></li>
    <li class="nav-latest-posts"><a href="https://sgbarker.com/blog/">Latest Posts</a></li>
</ul>

            </div>
            <div class="gh-head-actions">
                <div class="gh-social">
                </div>
            </div>
        </nav>
    </header>

    <div class="site-content">
        



<main id="site-main" class="site-main">
<article class="article post tag-software-engineering ">

    <header class="article-header gh-canvas">

        <div class="article-tag post-card-tags">
                <span class="post-card-primary-tag">
                    <a href="./../tag/software-engineering/">Software Engineering</a>
                </span>
        </div>

        <h1 class="article-title">How we reduced our failed payment rate by 92%</h1>


        <div class="article-byline">
        <section class="article-byline-content">

            <ul class="author-list">
                <li class="author-list-item">
                    <a href="./../author/steve/" class="author-avatar">
                        <img class="author-profile-image" src="./../content/images/size/w100/2021/09/ben-sweet-2LowviVHZ-E-unsplash.jpg" alt="Steve Barker" />
                    </a>
                </li>
            </ul>

            <div class="article-byline-meta">
                <h4 class="author-name"><a href="./../author/steve/">Steve Barker</a></h4>
                <div class="byline-meta-content">
                    <time class="byline-meta-date" datetime="2020-11-16">Nov 16, 2020</time>
                        <span class="byline-reading-time"><span class="bull">&bull;</span> 4 min read</span>
                </div>
            </div>

        </section>
        </div>

            <figure class="article-image">
                <img
                    srcset="./../content/images/size/w300/2021/03/pre-auth-flow-1.png 300w,
                            ./../content/images/size/w600/2021/03/pre-auth-flow-1.png 600w,
                            ./../content/images/size/w1000/2021/03/pre-auth-flow-1.png 1000w,
                            ./../content/images/size/w2000/2021/03/pre-auth-flow-1.png 2000w"
                    sizes="(min-width: 1400px) 1400px, 92vw"
                    src="./../content/images/size/w2000/2021/03/pre-auth-flow-1.png"
                    alt="How we reduced our failed payment rate by 92%"
                />
            </figure>

    </header>

    <section class="gh-content gh-canvas">
        <p><em>Originally posted on <a href="https://medium.com/gousto-engineering-techbrunch">Gousto Engineering &amp; Data</a></em></p><p>Most Gousto customers choose to get their <a href="https://www.gousto.co.uk/" rel="noopener">recipe boxes</a> on a subscription basis: every week they choose their recipes from our menu, and we pick, pack and deliver them to their door. To give customers as much flexibility as possible, we let customers edit their box right up until it’s sent to one of our factories for picking.</p><figure class="kg-card kg-image-card kg-width-wide"><img src="./../content/images/2021/03/box-flow.png" class="kg-image" alt loading="lazy" width="1268" height="526" srcset="https://sgbarker.com/blog/content/images/size/w600/2021/03/box-flow.png 600w, https://sgbarker.com/blog/content/images/size/w1000/2021/03/box-flow.png 1000w, https://sgbarker.com/blog/content/images/2021/03/box-flow.png 1268w" sizes="(min-width: 1200px) 1200px"></figure><h4 id="this-process-works-really-well-most-of-the-time-but-what-happens-when-a-customer%E2%80%99s-payment-fails">This process works really well most of the time. But what happens when a customer’s payment fails?</h4><p>It’s natural that a proportion of payments will fail — customers’ cards have changed, or there aren’t enough funds in the account. At Gousto we had a natural failed payment rate of around 2% for existing customers.</p><p>Until recently we only had two ways of handling a failed payment. First, we could send out the box anyway and put a debit on the customer’s account. Alternatively, we could just cancel the customer’s order.</p><p>Neither of these is a good solution. We never want to have to cancel a customer’s box, nor do we want to put a customer into ‘debt’. The majority of failed payments are because a customer has forgotten to update their card details and are still expecting to receive their order. I’m sure you can imagine how frustrating it might be to lose your food delivery for the week just because your debit card expired.</p><h4 id="how-did-we-reduce-failed-payments">How did we reduce failed payments?</h4><p>We decided to request a ‘dry run’ payment 24 hours before the actual payment is due — this is known as a <em>pre-authorisation. </em>Pre-auths allow merchants like Gousto to ‘reserve’ some amount of money against a customer’s payment method, without actually charging them. When we attempt to reserve these funds, we’ll receive a success or failure response from the customer’s bank. If unsuccessful, we can ask the customer to update their payment details.</p><figure class="kg-card kg-image-card kg-width-wide"><img src="./../content/images/2021/03/pre-auth-flow.png" class="kg-image" alt loading="lazy" width="1696" height="648" srcset="https://sgbarker.com/blog/content/images/size/w600/2021/03/pre-auth-flow.png 600w, https://sgbarker.com/blog/content/images/size/w1000/2021/03/pre-auth-flow.png 1000w, https://sgbarker.com/blog/content/images/size/w1600/2021/03/pre-auth-flow.png 1600w, https://sgbarker.com/blog/content/images/2021/03/pre-auth-flow.png 1696w" sizes="(min-width: 1200px) 1200px"></figure><p>As you can see, pre-auths allow us to catch a failed payment. We then email customers and give them 24 hours to update their card details in time for the final payment. This alone reduced our failed payment rate by 92%!</p><p>Many customers will receive a notification from their bank when the pre-auth is requested, which serves as an extra reminder of their upcoming box, with time for them to update their recipes before it’s dispatched. If the customer no longer wishes to receive their order, they also have the opportunity to cancel it through the app before it’s already paid for and dispatched. This reduces wasteful unintentional orders.</p><h4 id="how-do-pre-auths-actually-work">How do pre-auths actually work?</h4><p>When a merchant <a href="https://www.paymill.com/en/glossary/card-pre-authorisation/" rel="noopener">pre-authorises</a> funds on an account, it doesn’t have access to those funds yet; they’re ring-fenced for that merchant to use at some future point in time and the customer can’t use those funds for anything else.</p><p>If the merchant doesn’t end up charging the customer, the funds are released back to the customer by their bank after a period of time, typically five days. We built our system so that if a customer cancels a box that has been pre-authorised but not yet paid for, we would immediately void the pre-authorisation. This ensures we aren’t holding onto customers’ funds for any longer than is necessary.</p><hr><h4 id="how-did-we-engineer-this-enter-data-bulkheading"><strong>How did we engineer this? <em>Enter: Data bulkheading.</em></strong></h4><p>As I mentioned above, once a Gousto order is ‘cut-off’, it is no longer editable by the customer and is sent to one of our factories to be packed. This happens in batches of orders at a time, so it’s extremely important that this process is fault tolerant and speedy. To this end, many Gousto applications use a <a href="https://stackoverflow.com/questions/30391809/what-is-bulkhead-pattern-used-by-hystrix" rel="noopener"><em>bulkhead</em> architecture</a>, and our shiny new pre-auth system is no exception.</p><p>The pre-auth process comprises a series of <a href="https://medium.com/gousto-engineering-techbrunch/powering-the-supply-chain-with-serverless-architecture-part-2-323932bf4424">serverless</a> functions, but we don’t want these functions to have to rely on a centralised data store to do their job. Instead, they have their own data store, which keeps a copy of all upcoming orders with payments due in the near future. Not only does this save additional functions from putting more load on a single database, but should there be a fault in another part of the system, the payments data store will be unaffected. Fun fact: the bulkhead pattern is named after the isolated sections of a ship’s hull. If the hull is pierced, only the damaged section fills with water, preventing the rest from flooding.</p><figure class="kg-card kg-image-card"><img src="./../content/images/2021/03/container-ship.png" class="kg-image" alt loading="lazy" width="1172" height="806" srcset="https://sgbarker.com/blog/content/images/size/w600/2021/03/container-ship.png 600w, https://sgbarker.com/blog/content/images/size/w1000/2021/03/container-ship.png 1000w, https://sgbarker.com/blog/content/images/2021/03/container-ship.png 1172w" sizes="(min-width: 720px) 720px"></figure><p>The pre-auth system is an ideal use case for serverless functions. Demand for these services is very spiky — when a batch of orders is ‘cut off’ for example, we need a large amount of concurrency to quickly process them all. The rest of the time, we don’t see much activity, so it doesn’t make sense to pay for running servers.</p><p>For our payment functions to maintain a storage bulkhead, they need to be kept up to date with the state of orders. We utilise AWS SNS and SQS for this or — in other words — pub’ sub’. When any application within Gousto makes a change to an order, we publish to a topic. One of our payment functions is subscribed to this topic, and if the change affects the price or payment of the order, this update is added to its queue. The change is then persisted to the payments data store, ready to be processed.</p><p>After testing pre-auths on a small group of customers for a few weeks, we saw very positive results, both financially and from the feedback we received from customers! We have now rolled this out to everyone who uses Gousto.</p>
    </section>


</article>
</main>




            <aside class="read-more-wrap outer">
                <div class="read-more inner">
                        
<article class="post-card post">

    <a class="post-card-image-link" href="./../whatsapp-as-a-note-taking-app/">

        <img class="post-card-image"
            srcset="https://images.unsplash.com/photo-1632435499152-18838be77960?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;MnwxMTc3M3wwfDF8c2VhcmNofDh8fHdoYXRzYXBwfGVufDB8fHx8MTY1NTkzMzY4Ng&amp;ixlib&#x3D;rb-1.2.1&amp;q&#x3D;80&amp;w&#x3D;2000 300w,
                    https://images.unsplash.com/photo-1632435499152-18838be77960?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;MnwxMTc3M3wwfDF8c2VhcmNofDh8fHdoYXRzYXBwfGVufDB8fHx8MTY1NTkzMzY4Ng&amp;ixlib&#x3D;rb-1.2.1&amp;q&#x3D;80&amp;w&#x3D;2000 600w,
                    https://images.unsplash.com/photo-1632435499152-18838be77960?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;MnwxMTc3M3wwfDF8c2VhcmNofDh8fHdoYXRzYXBwfGVufDB8fHx8MTY1NTkzMzY4Ng&amp;ixlib&#x3D;rb-1.2.1&amp;q&#x3D;80&amp;w&#x3D;2000 1000w,
                    https://images.unsplash.com/photo-1632435499152-18838be77960?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;MnwxMTc3M3wwfDF8c2VhcmNofDh8fHdoYXRzYXBwfGVufDB8fHx8MTY1NTkzMzY4Ng&amp;ixlib&#x3D;rb-1.2.1&amp;q&#x3D;80&amp;w&#x3D;2000 2000w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="https://images.unsplash.com/photo-1632435499152-18838be77960?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;MnwxMTc3M3wwfDF8c2VhcmNofDh8fHdoYXRzYXBwfGVufDB8fHx8MTY1NTkzMzY4Ng&amp;ixlib&#x3D;rb-1.2.1&amp;q&#x3D;80&amp;w&#x3D;2000"
            alt="WhatsApp as a note-taking app"
            loading="lazy"
        />


    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="./../whatsapp-as-a-note-taking-app/">
            <header class="post-card-header">
                <div class="post-card-tags">
                </div>
                <h2 class="post-card-title">
                    WhatsApp as a note-taking app
                </h2>
            </header>
                <div class="post-card-excerpt">For short form note taking, WhatsApp is actually the best option I've found. It's fast, secure, available on all my devices, synchronised, searchable and free.</div>
        </a>

        <footer class="post-card-meta">
            <time class="post-card-meta-date" datetime="2022-06-22">Jun 22, 2022</time>
                <span class="sep">—</span>
                <span class="post-card-meta-length">2 min read</span>
        </footer>

    </div>

</article>
                        
<article class="post-card post">

    <a class="post-card-image-link" href="./../how-to-host-scalable-ghost-publication-for-free/">

        <img class="post-card-image"
            srcset="./../content/images/size/w300/2021/09/Screenshot-2021-09-30-at-10.33.39.png 300w,
                    ./../content/images/size/w600/2021/09/Screenshot-2021-09-30-at-10.33.39.png 600w,
                    ./../content/images/size/w1000/2021/09/Screenshot-2021-09-30-at-10.33.39.png 1000w,
                    ./../content/images/size/w2000/2021/09/Screenshot-2021-09-30-at-10.33.39.png 2000w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="./../content/images/size/w600/2021/09/Screenshot-2021-09-30-at-10.33.39.png"
            alt="How to host a highly scalable ghost publication for free"
            loading="lazy"
        />


    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="./../how-to-host-scalable-ghost-publication-for-free/">
            <header class="post-card-header">
                <div class="post-card-tags">
                </div>
                <h2 class="post-card-title">
                    How to host a highly scalable ghost publication for free
                </h2>
            </header>
                <div class="post-card-excerpt">TL;DR: Spin up a local container running Ghost, crawl the frontend to generate a static site, and upload to a free static host.

While there's quite a few options for statically hosting written content for free, most of these involve using markdown as your writing interface. While this is</div>
        </a>

        <footer class="post-card-meta">
            <time class="post-card-meta-date" datetime="2022-02-22">Feb 22, 2022</time>
                <span class="sep">—</span>
                <span class="post-card-meta-length">5 min read</span>
        </footer>

    </div>

</article>
                        
<article class="post-card post">

    <a class="post-card-image-link" href="./../photos-of-north-korea/">

        <img class="post-card-image"
            srcset="./../content/images/size/w300/2021/09/North-Korea-1-2.jpg 300w,
                    ./../content/images/size/w600/2021/09/North-Korea-1-2.jpg 600w,
                    ./../content/images/size/w1000/2021/09/North-Korea-1-2.jpg 1000w,
                    ./../content/images/size/w2000/2021/09/North-Korea-1-2.jpg 2000w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="./../content/images/size/w600/2021/09/North-Korea-1-2.jpg"
            alt="Photos of North Korea"
            loading="lazy"
        />


    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="./../photos-of-north-korea/">
            <header class="post-card-header">
                <div class="post-card-tags">
                </div>
                <h2 class="post-card-title">
                    Photos of North Korea
                </h2>
            </header>
                <div class="post-card-excerpt">I spent some time in North Korea (DPRK
[https://en.wikipedia.org/wiki/North_Korea]), via a specialist travel agency. I
didn't get as many good photos as I would have liked, but below are some of the
better ones.

Pyongyang with "traffic lady"DMZ and paintingVarious signs and sources</div>
        </a>

        <footer class="post-card-meta">
            <time class="post-card-meta-date" datetime="2021-07-28">Jul 28, 2021</time>
                <span class="sep">—</span>
                <span class="post-card-meta-length">3 min read</span>
        </footer>

    </div>

</article>
                </div>
            </aside>



    </div>

    <footer class="site-footer outer">
        <div class="inner">
            <section class="copyright"><a href="https://sgbarker.com/blog">Steve Barker</a> &copy; 2022</section>
            <nav class="site-footer-nav">
                <ul class="nav">
    <li class="nav-contact"><a href="mailto:webcontact@sgbarker.com">Contact</a></li>
    <li class="nav-other-writing"><a href="https://sgbarker.com/blog/other-writing/">Other Writing</a></li>
    <li class="nav-home"><a href="https://sgbarker.com">Home</a></li>
</ul>

            </nav>
            <div><a href="https://ghost.org/" target="_blank" rel="noopener">Powered by Ghost</a></div>
        </div>
    </footer>

</div>


<script
    src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous">
</script>
<script src="./../assets/built/casper.js?v=6e51bcce7f"></script>
<script>
$(document).ready(function () {
    // Mobile Menu Trigger
    $('.gh-burger').click(function () {
        $('body').toggleClass('gh-head-open');
    });
    // FitVids - Makes video embeds responsive
    $(".gh-content").fitVids();
});
</script>



</body>
</html>
